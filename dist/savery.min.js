!(function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("savery",[],t):"object"==typeof exports?exports.savery=t():e.savery=t()})(this,(function(){return (function(e){function t(r){if(o[r])return o[r].exports;var n=o[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)})([function(e,t,o){e.exports=o(1)},function(e,t,o){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){var o={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(o[r]=e[r]);return o}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},i=o(2),s=r(i),p=o(4),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"download.txt",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.type,r=n(t,["type"]),i=(0,p.getMimeType)(o,e);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new s.default(t,e,a({},r,{mimeType:i}))}};t.default=u,e.exports=t.default},function(e,t,o){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}})(),a=o(3),i=o(4),s=(function(){function e(t,o){var n=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e),this.autoBOM=!0,this.data=null,this.error=null,this.filename="",this.forceLoad=!1,this.onAbort=i.noop,this.onAfterSave=i.passThrough,this.onBeforeSave=i.passThrough,this.onEndSave=i.noop,this.onError=i.noop,this.onStartSave=i.noop,this.size=0,this.status=a.STATUSES.PENDING,this.mimeType=a.DEFAULT_MIME_TYPE,this._onAfterSave=function(){return n.status!==a.STATUSES.COMPLETE?Promise.reject(n):n.onAfterSave(n)},this._onBeforeSave=function(){return n.status!==a.STATUSES.PENDING?Promise.reject(n):n.onBeforeSave(n.data)},this._onEndSave=function(e){return n.status!==a.STATUSES.PROCESSING?Promise.reject(n):((0,i.revokeObjectUrl)(e),n.status=a.STATUSES.COMPLETE,n.onEndSave(n),e)},this._onError=function(e){return n.status!==a.STATUSES.CANCELLED&&(n.status=a.STATUSES.ERROR),n.onError(e),Promise.reject(e)},this._onSave=function(){if(n.status!==a.STATUSES.PROCESSING)return Promise.reject(n);var e=(0,i.createBlob)(n.data,n.mimeType),t=n.autoBOM?(0,i.setAutoBom)(e):e,o=(0,i.createObjectUrl)(t);return n.size=e.size,a.HAS_DOWNLOAD_ATTRIBUTE_SUPPORT?((0,i.saveWithDownloadAttribute)(o,n.filename),o):a.IS_CHROME_OR_IOS||n.forceLoad&&a.IS_SAFARI||a.GLOBAL.FileReader?(0,i.saveWithFileReader)(t):(n.forceLoad?a.GLOBAL.location.href=o:(0,i.openPopupOrNavigate)(o),n.status=a.STATUSES.COMPLETE,o)},this._onStartSave=function(){return n.status!==a.STATUSES.PENDING?Promise.reject(n):(n.status=a.STATUSES.PROCESSING,n.onStartSave(n),n)};var p=s.mimeType,u=s.onAbort,c=void 0===u?i.noop:u,l=s.onAfterSave,f=void 0===l?i.passThrough:l,v=s.onBeforeSave,d=void 0===v?i.passThrough:v,E=s.onError,S=void 0===E?i.noop:E,h=s.onStartSave,m=void 0===h?i.noop:h,T=s.onEndSave,O=void 0===T?i.noop:T,_=s.shouldAutoBom,A=void 0===_||_;return this.autoBOM=A,this.data=t,this.error=null,this.filename=o,this.forceLoad=p===a.DEFAULT_MIME_TYPE,this.mimeType=p,this.onAbort=c,this.onAfterSave=f,this.onBeforeSave=d,this.onError=S,this.onStartSave=m,this.onEndSave=O,this}return n(e,[{key:"abort",value:function(){return this.status===a.STATUSES.PENDING||this.status===a.STATUSES.PROCESSING?(this.status=a.STATUSES.CANCELLED,this.error=new Error("Savery for "+this.filename+" was aborted."),this.onAbort(this),this):(this.error=new Error("Savery has already completed for "+this.filename+"."),Promise.reject(this))}},{key:"save",value:function(){return Promise.resolve().then(this._onBeforeSave).then(this._onStartSave).then(this._onSave).then(this._onEndSave).then(this._onAfterSave).catch(this._onError)}}]),e})();t.default=s,e.exports=t.default},function(e,t){(function(e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="application/octet-stream",r=/^[a-zA-Z\-]+\/([a-zA-Z0-9.\-+]+)+$/,n={CANCELLED:"CANCELLED",COMPLETE:"COMPLETE",ERROR:"ERROR",PENDING:"PENDING",PROCESSING:"PROCESSING"},a=window||e,i=a.document,s=a.URL||a.webkitURL,p=i.createElementNS("http://www.w3.org/1999/xhtml","a"),u=/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i,c=/CriOS\/[\d]+/,l=/^data:[^;]*;/,f=/constructor/i,v="download"in p,d=c.test(a.navigator.userAgent),E=f.test(a.HTMLElement)||a.safari,S=3e4;t.AUTO_BOM_REGEXP=u,t.CHROME_OR_IOS_REGEXP=c,t.DEFAULT_MIME_TYPE=o,t.GLOBAL=a,t.HAS_DOWNLOAD_ATTRIBUTE_SUPPORT=v,t.IS_CHROME_OR_IOS=d,t.IS_SAFARI=E,t.LINK=p,t.MIME_TYPE_REGEXP=r,t.READER_REPLACE_REGEXP=l,t.REVOKE_TIMEOUT=S,t.SAFARI_REGEXP=f,t.STATUSES=n,t.URL=s}).call(t,(function(){return this})())},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setAutoBom=t.saveWithFileReader=t.saveWithDownloadAttribute=t.triggerClick=t.revokeObjectUrl=t.passThrough=t.openPopupOrNavigate=t.noop=t.getMimeType=t.createObjectUrl=t.createBlob=void 0;var r=o(3),n=o(5),a=function(e,t){return new window.Blob([e],{type:t})};t.createBlob=a;var i=function(e){return URL.createObjectURL(e)};t.createObjectUrl=i;var s=function(e,t){if(!e){var o=t.slice(t.lastIndexOf(".")+1).toLowerCase();return n.lookup(o)||r.DEFAULT_MIME_TYPE}var a=e.toLowerCase();if(r.MIME_TYPE_REGEXP.test(a.split(";")[0]))return a;var i=n.lookup(a);return i?i:r.DEFAULT_MIME_TYPE};t.getMimeType=s;var p=function(){return null};t.noop=p;var u=function(e){var t=r.GLOBAL.open(e,"_blank");t||(r.GLOBAL.location.href=e)};t.openPopupOrNavigate=u;var c=function(e){return e};t.passThrough=c;var l=function(e){setTimeout((function(){"string"==typeof e?URL.revokeObjectURL(e):e.remove()}),r.REVOKE_TIMEOUT)};t.revokeObjectUrl=l;var f=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)};t.triggerClick=f;var v=function(e,t){r.LINK.href=e,r.LINK.download=t,f(r.LINK)};t.saveWithDownloadAttribute=v;var d=function(e){return e?new Promise(function(t){var o=new window.FileReader;o.onloadend=function(){var e=r.IS_CHROME_OR_IOS?o.result:o.result.replace(r.READER_REPLACE_REGEXP,"data:attachment/file;");u(e),t(e)},o.readAsDataURL(e)}):Promise.reject(new Error("No data provided to FileReader."))};t.saveWithFileReader=d;var E=function(e){return r.AUTO_BOM_REGEXP.test(e.type)?new window.Blob([String.fromCharCode(65279),e],{type:e.type}):e};t.setAutoBom=E},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={"7z":"application/x-7z-compressed",bmp:"image/bmp",conf:"text/plain",css:"text/css",csv:"text/csv",dmg:"application/x-apple-diskimage",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",gif:"image/gif",gz:"application/x-gzip",html:"text/html",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",log:"text/plain",map:"application/json",mov:"video/quicktime",mp3:"audio/mp3",mp4:"video/mp4",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",pdf:"application/pdf",png:"image/png",ps:"application/postscript",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",psd:"image/vnd.adobe.photoshop",qt:"video/quicktime",rar:"application/x-rar-compressed",rtf:"text/rtf",svg:"image/svg+xml",text:"text/plain",torrent:"application/x-bittorrent",txt:"text/plain",tiff:"image/tiff",war:"application/java-archive",weba:"audio/webm",webm:"video/webm",webp:"image/webp",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",zip:"application/zip"},r=function(e){return o[e]||""};t.default={lookup:r},e.exports=t.default}])}));